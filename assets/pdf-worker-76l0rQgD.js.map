{"version":3,"file":"pdf-worker-76l0rQgD.js","sources":["../../packages/excalidraw/pdf/pdf-worker.ts"],"sourcesContent":["export interface Request {\n  pdf: ArrayBuffer,\n  fromPage: number\n}\n\nexport interface Response {\n  converting?: {\n    pageIndex: number\n  },\n  converted?: {\n    svgFile: File,\n  }\n  done: boolean\n}\n\nasync function processPdf({ pdf, fromPage }: Request) {\n  // @ts-ignore\n  let mupdf = await import(\"mupdf\")\n\n  const document = mupdf.Document.openDocument(pdf)\n  const pageCount = document.countPages()\n\n  for (let pageIndex = fromPage; pageIndex < pageCount; pageIndex++) {\n    postMessage({ converting: { pageIndex }, done: false } as Response)\n\n    let buffer = new mupdf.Buffer()\n    let writer = new mupdf.DocumentWriter(buffer, \"svg\", \"text=path\")\n    let page = document.loadPage(pageIndex)\n\n    let device = writer.beginPage(page.getBounds())\n    page.run(device, mupdf.Matrix.identity)\n    writer.endPage()\n\n    device.close()\n    device.destroy()\n    page.destroy()\n    writer.close()\n    writer.destroy()\n\n    const svgFile = new File([buffer.asUint8Array()], `page${pageIndex}.svg`, { type: \"image/svg+xml\" })\n\n    buffer.destroy()\n\n    postMessage({\n      converted: {\n        svgFile\n      },\n      done: false\n    } as Response)\n  }\n\n  postMessage({ done: true } as Response)\n}\n\nonmessage = async ({ data }: MessageEvent<Request>) => {\n  processPdf(data)\n    .catch(error => setTimeout(() => { throw error })) // Errors are not sent to `onerror` when using promises\n}\n"],"names":["processPdf","pdf","fromPage","mupdf","document","pageCount","pageIndex","buffer","writer","page","device","svgFile","data","error"],"mappings":"AAeA,eAAeA,EAAW,CAAE,IAAAC,EAAK,SAAAC,GAAqB,CAEhD,IAAAC,EAAQ,KAAM,QAAO,qBAAO,EAEhC,MAAMC,EAAWD,EAAM,SAAS,aAAaF,CAAG,EAC1CI,EAAYD,EAAS,WAAW,EAEtC,QAASE,EAAYJ,EAAUI,EAAYD,EAAWC,IAAa,CACjE,YAAY,CAAE,WAAY,CAAE,UAAAA,GAAa,KAAM,GAAmB,EAE9D,IAAAC,EAAS,IAAIJ,EAAM,OACnBK,EAAS,IAAIL,EAAM,eAAeI,EAAQ,MAAO,WAAW,EAC5DE,EAAOL,EAAS,SAASE,CAAS,EAElCI,EAASF,EAAO,UAAUC,EAAK,WAAW,EAC9CA,EAAK,IAAIC,EAAQP,EAAM,OAAO,QAAQ,EACtCK,EAAO,QAAQ,EAEfE,EAAO,MAAM,EACbA,EAAO,QAAQ,EACfD,EAAK,QAAQ,EACbD,EAAO,MAAM,EACbA,EAAO,QAAQ,EAEf,MAAMG,EAAU,IAAI,KAAK,CAACJ,EAAO,aAAa,CAAC,EAAG,OAAOD,CAAS,OAAQ,CAAE,KAAM,gBAAiB,EAEnGC,EAAO,QAAQ,EAEH,YAAA,CACV,UAAW,CACT,QAAAI,CACF,EACA,KAAM,EAAA,CACK,CAAA,CAGH,YAAA,CAAE,KAAM,GAAkB,CACxC,CAEA,UAAY,MAAO,CAAE,KAAAC,KAAkC,CACrDZ,EAAWY,CAAI,EACZ,MAAMC,GAAS,WAAW,IAAM,CAAQ,MAAAA,CAAA,CAAO,CAAC,CACrD"}